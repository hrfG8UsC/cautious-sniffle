name: Manual

on:
  workflow_dispatch:
    inputs:
      username:
        description: 'User name'
        required: true
        type: string

jobs:
  main:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: 3.9
      - uses: FedericoCarboni/setup-ffmpeg@v2
      
      - run: wget -O- "https://ip.mha.fi/"

      - run: pip install -r requirements.txt
      - run: python3 main.py ${{ inputs.username }}
        env:
          MEGA_EMAIL: ${{ secrets.MEGA_EMAIL }}
          MEGA_PASSWORD: ${{ secrets.MEGA_PASSWORD }}

      - run: ffmpeg -i "https://nitter.freedit.eu/video/625656C3D808C/https%3A%2F%2Fvideo.twimg.com%2Fext_tw_video%2F1641960269072019457%2Fpu%2Fpl%2FtyRETRqJXhAaroAl.m3u8%3Ftag%3D12%26container%3Dfmp4%26v%3D465" -c copy dl/tw_video_1681664553.5870426b.mp4

      - uses: actions/upload-artifact@v3
        with:
          name: ${{ inputs.username }}
          path: dl/
